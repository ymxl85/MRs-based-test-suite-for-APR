#!/bin/bash
set -euo pipefail
subjectProg="tcas" #$1
subdir="T0" #$2
version="$1" #"1" #$3

subject=${subdir}/${subjectProg}
SCRIPT_DIR=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)

usage="Usage: repair VERSION"

SUBJECT_DIR=${SCRIPT_DIR}/${subject}


arguments="$@"

if [ ! -f $SUBJECT_DIR/golden/$subject ]; then
   (cd $SUBJECT_DIR/golden/; make &> /dev/null)
fi

src=$SUBJECT_DIR/$version
golden=$SUBJECT_DIR/golden
oracle=$SUBJECT_DIR/oracle

test_suite=`cat $SUBJECT_DIR/tc.txt`

echo $src
echo $golden
echo $oracle

angelix $src $subjectProg.c $oracle $test_suite --golden $golden \
    `./get-options $subjectProg $version` \
    $arguments
